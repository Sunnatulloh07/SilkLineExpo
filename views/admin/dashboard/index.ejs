<!DOCTYPE html>
<html lang="<%= currentLang || 'uz' %>" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - SLEX Admin</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- CSS -->
    <link href="/assets/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/css/line-awesome.min.css" rel="stylesheet">
    <link href="/admin/css/admin-theme.css" rel="stylesheet">
    <link href="/admin/css/admin-components.css" rel="stylesheet">
    <link href="/admin/css/admin-responsive.css" rel="stylesheet">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="admin-layout">
    <div class="admin-wrapper">
        <!-- Sidebar -->
        <%- include('../partials/sidebar', { currentPage: 'dashboard', user: user }) %>
        
        <!-- Main Content -->
        <div class="admin-main">
            <!-- Header -->
            <%- include('../partials/header', { 
                user: user, 
                title: 'Dashboard',
                breadcrumb: [
                    { title: 'Dashboard' }
                ],
                currentLang: typeof currentLang !== 'undefined' ? currentLang : 'uz'
            }) %>
            
            <!-- Content -->
            <div class="admin-content">
                <div class="container-fluid">
                    <!-- Welcome Section -->
                    <div class="welcome-section mb-4">
                        <div class="welcome-card">
                            <div class="welcome-content">
                                <div class="welcome-text">
                                    <h2 class="welcome-title">Welcome back, <%= user.name %>!</h2>
                                    <p class="welcome-subtitle">Here's what's happening with your platform today.</p>
                                </div>
                                <div class="welcome-stats">
                                    <div class="quick-stat">
                                        <span class="stat-number" id="todayRegistrations">0</span>
                                        <span class="stat-label">New Registrations Today</span>
                                    </div>
                                    <div class="quick-stat">
                                        <span class="stat-number" id="pendingApprovals">0</span>
                                        <span class="stat-label">Pending Approvals</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>   
                 <!-- Main Metrics -->
                    <div class="metrics-grid mb-4">
                        <div class="metric-card metric-primary">
                            <div class="metric-content">
                                <div class="metric-icon">
                                    <i class="las la-building"></i>
                                </div>
                                <div class="metric-details">
                                    <h3 class="metric-value" id="totalCompanies">0</h3>
                                    <p class="metric-label">Total Companies</p>
                                    <span class="metric-trend positive">
                                        <i class="las la-arrow-up"></i>
                                        <span id="companiesGrowth">+0%</span> this month
                                    </span>
                                </div>
                            </div>
                            <div class="metric-chart">
                                <canvas id="companiesChart" width="60" height="30"></canvas>
                            </div>
                        </div>
                        
                        <div class="metric-card metric-success">
                            <div class="metric-content">
                                <div class="metric-icon">
                                    <i class="las la-check-circle"></i>
                                </div>
                                <div class="metric-details">
                                    <h3 class="metric-value" id="activeCompanies">0</h3>
                                    <p class="metric-label">Active Companies</p>
                                    <span class="metric-trend positive">
                                        <i class="las la-arrow-up"></i>
                                        <span id="activeGrowth">+0%</span> this week
                                    </span>
                                </div>
                            </div>
                            <div class="metric-chart">
                                <canvas id="activeChart" width="60" height="30"></canvas>
                            </div>
                        </div>
                        
                        <div class="metric-card metric-warning">
                            <div class="metric-content">
                                <div class="metric-icon">
                                    <i class="las la-clock"></i>
                                </div>
                                <div class="metric-details">
                                    <h3 class="metric-value" id="pendingCompanies">0</h3>
                                    <p class="metric-label">Pending Approval</p>
                                    <span class="metric-trend neutral">
                                        <i class="las la-minus"></i>
                                        <span id="pendingChange">0</span> from yesterday
                                    </span>
                                </div>
                            </div>
                            <div class="metric-chart">
                                <canvas id="pendingChart" width="60" height="30"></canvas>
                            </div>
                        </div>
                        
                        <div class="metric-card metric-info">
                            <div class="metric-content">
                                <div class="metric-icon">
                                    <i class="las la-box"></i>
                                </div>
                                <div class="metric-details">
                                    <h3 class="metric-value" id="totalProducts">0</h3>
                                    <p class="metric-label">Total Products</p>
                                    <span class="metric-trend positive">
                                        <i class="las la-arrow-up"></i>
                                        <span id="productsGrowth">+0%</span> this month
                                    </span>
                                </div>
                            </div>
                            <div class="metric-chart">
                                <canvas id="productsChart" width="60" height="30"></canvas>
                            </div>
                        </div>
                    </div>        
            <!-- Dashboard Content Grid -->
                    <div class="row g-4">
                        <!-- Recent Activity -->
                        <div class="col-lg-8">
                            <div class="dashboard-card">
                                <div class="card-header">
                                    <div class="card-title-section">
                                        <h3 class="card-title">
                                            <i class="las la-chart-line"></i>
                                            Registration Analytics
                                        </h3>
                                        <p class="card-subtitle">Company registration trends over time</p>
                                    </div>
                                    <div class="card-actions">
                                        <div class="btn-group" role="group">
                                            <button class="btn btn-sm btn-outline-secondary active" data-period="7d" onclick="updateChart('7d')">7D</button>
                                            <button class="btn btn-sm btn-outline-secondary" data-period="30d" onclick="updateChart('30d')">30D</button>
                                            <button class="btn btn-sm btn-outline-secondary" data-period="90d" onclick="updateChart('90d')">90D</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="chart-container">
                                        <canvas id="registrationChart" height="300"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Quick Actions -->
                        <div class="col-lg-4">
                            <div class="dashboard-card">
                                <div class="card-header">
                                    <div class="card-title-section">
                                        <h3 class="card-title">
                                            <i class="las la-bolt"></i>
                                            Quick Actions
                                        </h3>
                                        <p class="card-subtitle">Common administrative tasks</p>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="quick-actions">
                                        <a href="/admin/pending-approvals" class="quick-action-item">
                                            <div class="action-icon bg-warning">
                                                <i class="las la-user-check"></i>
                                            </div>
                                            <div class="action-content">
                                                <h6>Review Pending</h6>
                                                <p><span id="quickPendingCount">0</span> companies waiting</p>
                                            </div>
                                            <div class="action-arrow">
                                                <i class="las la-arrow-right"></i>
                                            </div>
                                        </a>
                                        
                                        <a href="/admin/users" class="quick-action-item">
                                            <div class="action-icon bg-primary">
                                                <i class="las la-users"></i>
                                            </div>
                                            <div class="action-content">
                                                <h6>Manage Users</h6>
                                                <p>View all registered companies</p>
                                            </div>
                                            <div class="action-arrow">
                                                <i class="las la-arrow-right"></i>
                                            </div>
                                        </a>
                                        
                                        <a href="/admin/products" class="quick-action-item">
                                            <div class="action-icon bg-success">
                                                <i class="las la-box"></i>
                                            </div>
                                            <div class="action-content">
                                                <h6>Product Management</h6>
                                                <p>Moderate product listings</p>
                                            </div>
                                            <div class="action-arrow">
                                                <i class="las la-arrow-right"></i>
                                            </div>
                                        </a>
                                        
                                        <a href="/admin/system/logs" class="quick-action-item">
                                            <div class="action-icon bg-info">
                                                <i class="las la-file-alt"></i>
                                            </div>
                                            <div class="action-content">
                                                <h6>System Logs</h6>
                                                <p>Monitor system activity</p>
                                            </div>
                                            <div class="action-arrow">
                                                <i class="las la-arrow-right"></i>
                                            </div>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>        
            <!-- Second Row -->
                    <div class="row g-4 mt-2">
                        <!-- Recent Registrations -->
                        <div class="col-lg-6">
                            <div class="dashboard-card">
                                <div class="card-header">
                                    <div class="card-title-section">
                                        <h3 class="card-title">
                                            <i class="las la-user-plus"></i>
                                            Recent Registrations
                                        </h3>
                                        <p class="card-subtitle">Latest company registrations</p>
                                    </div>
                                    <div class="card-actions">
                                        <a href="/admin/pending-approvals" class="btn btn-sm btn-outline-primary">
                                            View All
                                        </a>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="recent-registrations" id="recentRegistrations">
                                        <div class="empty-state text-center py-4">
                                            <i class="las la-user-plus empty-state-icon"></i>
                                            <h6 class="empty-state-title">No Recent Registrations</h6>
                                            <p class="empty-state-text">New company registrations will appear here</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- System Status -->
                        <div class="col-lg-6">
                            <div class="dashboard-card">
                                <div class="card-header">
                                    <div class="card-title-section">
                                        <h3 class="card-title">
                                            <i class="las la-server"></i>
                                            System Status
                                        </h3>
                                        <p class="card-subtitle">Platform health and performance</p>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="system-status">
                                        <div class="status-item">
                                            <div class="status-indicator">
                                                <div class="status-dot status-online"></div>
                                                <span class="status-label">Database</span>
                                            </div>
                                            <span class="status-value">Online</span>
                                        </div>
                                        
                                        <div class="status-item">
                                            <div class="status-indicator">
                                                <div class="status-dot status-online"></div>
                                                <span class="status-label">API Services</span>
                                            </div>
                                            <span class="status-value">Operational</span>
                                        </div>
                                        
                                        <div class="status-item">
                                            <div class="status-indicator">
                                                <div class="status-dot status-warning"></div>
                                                <span class="status-label">Email Service</span>
                                            </div>
                                            <span class="status-value">Limited</span>
                                        </div>
                                        
                                        <div class="status-item">
                                            <div class="status-indicator">
                                                <div class="status-dot status-online"></div>
                                                <span class="status-label">File Storage</span>
                                            </div>
                                            <span class="status-value">Available</span>
                                        </div>
                                        
                                        <div class="system-metrics mt-4">
                                            <div class="metric-row">
                                                <span class="metric-label">Uptime</span>
                                                <span class="metric-value">99.9%</span>
                                            </div>
                                            <div class="metric-row">
                                                <span class="metric-label">Response Time</span>
                                                <span class="metric-value">245ms</span>
                                            </div>
                                            <div class="metric-row">
                                                <span class="metric-label">Active Sessions</span>
                                                <span class="metric-value" id="activeSessions">0</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>    
                <!-- Third Row -->
                    <div class="row g-4 mt-2">
                        <!-- Country Distribution -->
                        <div class="col-lg-4">
                            <div class="dashboard-card">
                                <div class="card-header">
                                    <div class="card-title-section">
                                        <h3 class="card-title">
                                            <i class="las la-globe"></i>
                                            Country Distribution
                                        </h3>
                                        <p class="card-subtitle">Companies by country</p>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="chart-container">
                                        <canvas id="countryChart" height="250"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Activity Types -->
                        <div class="col-lg-4">
                            <div class="dashboard-card">
                                <div class="card-header">
                                    <div class="card-title-section">
                                        <h3 class="card-title">
                                            <i class="las la-industry"></i>
                                            Activity Types
                                        </h3>
                                        <p class="card-subtitle">Companies by industry</p>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="activity-types" id="activityTypes">
                                        <div class="activity-item">
                                            <div class="activity-info">
                                                <div class="activity-color" style="background: #3b82f6;"></div>
                                                <span class="activity-name">Food & Beverages</span>
                                            </div>
                                            <span class="activity-count">0</span>
                                        </div>
                                        <div class="activity-item">
                                            <div class="activity-info">
                                                <div class="activity-color" style="background: #10b981;"></div>
                                                <span class="activity-name">Textiles & Clothing</span>
                                            </div>
                                            <span class="activity-count">0</span>
                                        </div>
                                        <div class="activity-item">
                                            <div class="activity-info">
                                                <div class="activity-color" style="background: #f59e0b;"></div>
                                                <span class="activity-name">Electronics</span>
                                            </div>
                                            <span class="activity-count">0</span>
                                        </div>
                                        <div class="activity-item">
                                            <div class="activity-info">
                                                <div class="activity-color" style="background: #ef4444;"></div>
                                                <span class="activity-name">Machinery</span>
                                            </div>
                                            <span class="activity-count">0</span>
                                        </div>
                                        <div class="activity-item">
                                            <div class="activity-info">
                                                <div class="activity-color" style="background: #8b5cf6;"></div>
                                                <span class="activity-name">Other</span>
                                            </div>
                                            <span class="activity-count">0</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Admin Activity -->
                        <div class="col-lg-4">
                            <div class="dashboard-card">
                                <div class="card-header">
                                    <div class="card-title-section">
                                        <h3 class="card-title">
                                            <i class="las la-user-shield"></i>
                                            Admin Activity
                                        </h3>
                                        <p class="card-subtitle">Your recent actions</p>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="admin-activity" id="adminActivity">
                                        <div class="activity-timeline">
                                            <div class="timeline-item">
                                                <div class="timeline-marker bg-success"></div>
                                                <div class="timeline-content">
                                                    <p class="timeline-text">Logged in to dashboard</p>
                                                    <span class="timeline-time">Just now</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>    
<!-- Scripts -->
    <script src="/assets/js/bootstrap.bundle.min.js"></script>
    <script src="/admin/js/admin-theme.js"></script>

    <script>
    // Dashboard Data and Charts
    class AdminDashboard {
        constructor() {
            this.charts = {};
            this.data = {
                companies: {
                    total: 0,
                    active: 0,
                    pending: 0,
                    growth: 0
                },
                products: {
                    total: 0,
                    growth: 0
                }
            };
            this.init();
        }

        async init() {
            await this.loadDashboardData();
            this.initializeCharts();
            this.updateMetrics();
            this.loadRecentRegistrations();
            this.startRealTimeUpdates();
        }

        async loadDashboardData() {
            try {
                const response = await fetch('/admin/api/dashboard/stats');
                if (response.ok) {
                    const result = await response.json();
                    this.data = result.data || this.data;
                } else {
                    console.warn('Failed to load dashboard data, using mock data');
                    this.generateMockData();
                }
            } catch (error) {
                console.error('Dashboard data error:', error);
                this.generateMockData();
            }
        }

        generateMockData() {
            this.data = {
                companies: {
                    total: 47,
                    active: 32,
                    pending: 8,
                    growth: 12.5
                },
                products: {
                    total: 156,
                    growth: 8.3
                },
                registrations: {
                    today: 3,
                    thisWeek: 12,
                    thisMonth: 47
                }
            };
        }

        updateMetrics() {
            // Update main metrics
            document.getElementById('totalCompanies').textContent = this.data.companies.total;
            document.getElementById('activeCompanies').textContent = this.data.companies.active;
            document.getElementById('pendingCompanies').textContent = this.data.companies.pending;
            document.getElementById('totalProducts').textContent = this.data.products.total;

            // Update growth indicators
            document.getElementById('companiesGrowth').textContent = `+${this.data.companies.growth}%`;
            document.getElementById('activeGrowth').textContent = `+${Math.round(this.data.companies.growth * 0.8)}%`;
            document.getElementById('productsGrowth').textContent = `+${this.data.products.growth}%`;

            // Update quick stats
            document.getElementById('todayRegistrations').textContent = this.data.registrations?.today || 0;
            document.getElementById('pendingApprovals').textContent = this.data.companies.pending;
            document.getElementById('quickPendingCount').textContent = this.data.companies.pending;

            // Update system metrics
            document.getElementById('activeSessions').textContent = Math.floor(Math.random() * 50) + 20;
        }

        initializeCharts() {
            this.initRegistrationChart();
            this.initCountryChart();
            this.initMiniCharts();
        }

        initRegistrationChart() {
            const ctx = document.getElementById('registrationChart');
            if (!ctx) return;

            const mockData = this.generateRegistrationData();
            
            this.charts.registration = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: mockData.labels,
                    datasets: [{
                        label: 'New Registrations',
                        data: mockData.registrations,
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }, {
                        label: 'Approvals',
                        data: mockData.approvals,
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0,0,0,0.1)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }  
      initCountryChart() {
            const ctx = document.getElementById('countryChart');
            if (!ctx) return;

            const countries = ['Uzbekistan', 'Kazakhstan', 'China', 'Tajikistan', 'Kyrgyzstan'];
            const data = [15, 12, 8, 7, 5];
            const colors = ['#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6'];

            this.charts.country = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: countries,
                    datasets: [{
                        data: data,
                        backgroundColor: colors,
                        borderWidth: 2,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true
                            }
                        }
                    }
                }
            });
        }

        initMiniCharts() {
            // Mini charts for metrics
            this.createMiniChart('companiesChart', [20, 25, 30, 28, 35, 40, 47]);
            this.createMiniChart('activeChart', [15, 18, 22, 20, 25, 28, 32]);
            this.createMiniChart('pendingChart', [5, 8, 12, 10, 6, 9, 8]);
            this.createMiniChart('productsChart', [80, 95, 110, 125, 140, 150, 156]);
        }

        createMiniChart(canvasId, data) {
            const ctx = document.getElementById(canvasId);
            if (!ctx) return;

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['', '', '', '', '', '', ''],
                    datasets: [{
                        data: data,
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        x: { display: false },
                        y: { display: false }
                    },
                    elements: {
                        point: { radius: 0 }
                    }
                }
            });
        }

        generateRegistrationData() {
            const labels = [];
            const registrations = [];
            const approvals = [];
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                labels.push(date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));
                
                registrations.push(Math.floor(Math.random() * 8) + 2);
                approvals.push(Math.floor(Math.random() * 6) + 1);
            }
            
            return { labels, registrations, approvals };
        }

        async loadRecentRegistrations() {
            try {
                const response = await fetch('/admin/api/pending-approvals?limit=5');
                if (response.ok) {
                    const result = await response.json();
                    this.displayRecentRegistrations(result.data?.pendingUsers || []);
                } else {
                    this.displayMockRegistrations();
                }
            } catch (error) {
                console.error('Recent registrations error:', error);
                this.displayMockRegistrations();
            }
        }

        displayRecentRegistrations(registrations) {
            const container = document.getElementById('recentRegistrations');
            if (!container) return;

            if (registrations.length === 0) {
                container.innerHTML = `
                    <div class="empty-state text-center py-4">
                        <i class="las la-user-plus empty-state-icon"></i>
                        <h6 class="empty-state-title">No Recent Registrations</h6>
                        <p class="empty-state-text">New company registrations will appear here</p>
                    </div>
                `;
                return;
            }

            const html = registrations.map(reg => `
                <div class="registration-item">
                    <div class="registration-avatar">
                        ${reg.companyLogo ? 
                            `<img src="${reg.companyLogo.url}" alt="${reg.companyName}">` :
                            `<div class="avatar-placeholder">${reg.companyName.charAt(0)}</div>`
                        }
                    </div>
                    <div class="registration-info">
                        <h6 class="registration-name">${reg.companyName}</h6>
                        <p class="registration-details">
                            <span class="registration-country">${reg.country}</span> â€¢ 
                            <span class="registration-activity">${this.formatActivityType(reg.activityType)}</span>
                        </p>
                        <span class="registration-time">${this.formatTimeAgo(reg.createdAt)}</span>
                    </div>
                    <div class="registration-actions">
                        <a href="/admin/users/${reg._id}" class="btn btn-sm btn-outline-primary">
                            <i class="las la-eye"></i>
                        </a>
                    </div>
                </div>
            `).join('');

            container.innerHTML = html;
        }        di
splayMockRegistrations() {
            const mockRegistrations = [
                {
                    _id: '1',
                    companyName: 'Silk Road Textiles LLC',
                    country: 'Uzbekistan',
                    activityType: 'textiles_clothing',
                    createdAt: new Date(Date.now() - 2 * 60 * 60 * 1000) // 2 hours ago
                },
                {
                    _id: '2',
                    companyName: 'Central Asia Foods',
                    country: 'Kazakhstan',
                    activityType: 'food_beverages',
                    createdAt: new Date(Date.now() - 5 * 60 * 60 * 1000) // 5 hours ago
                },
                {
                    _id: '3',
                    companyName: 'Beijing Electronics Co',
                    country: 'China',
                    activityType: 'electronics',
                    createdAt: new Date(Date.now() - 1 * 24 * 60 * 60 * 1000) // 1 day ago
                }
            ];
            
            this.displayRecentRegistrations(mockRegistrations);
        }

        formatActivityType(type) {
            const types = {
                'food_beverages': 'Food & Beverages',
                'textiles_clothing': 'Textiles & Clothing',
                'electronics': 'Electronics',
                'machinery_equipment': 'Machinery & Equipment',
                'chemicals': 'Chemicals',
                'agriculture': 'Agriculture',
                'construction_materials': 'Construction Materials',
                'automotive': 'Automotive',
                'pharmaceuticals': 'Pharmaceuticals',
                'other': 'Other'
            };
            return types[type] || type;
        }

        formatTimeAgo(date) {
            const now = new Date();
            const diff = now - new Date(date);
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(diff / 3600000);
            const days = Math.floor(diff / 86400000);

            if (minutes < 60) return `${minutes}m ago`;
            if (hours < 24) return `${hours}h ago`;
            return `${days}d ago`;
        }

        startRealTimeUpdates() {
            // Update metrics every 30 seconds
            setInterval(() => {
                this.loadDashboardData().then(() => {
                    this.updateMetrics();
                });
            }, 30000);

            // Update recent registrations every 2 minutes
            setInterval(() => {
                this.loadRecentRegistrations();
            }, 120000);
        }

        updateChart(period) {
            // Update active button
            document.querySelectorAll('[data-period]').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-period="${period}"]`).classList.add('active');

            // Generate new data based on period
            const newData = this.generateRegistrationData();
            
            if (this.charts.registration) {
                this.charts.registration.data.labels = newData.labels;
                this.charts.registration.data.datasets[0].data = newData.registrations;
                this.charts.registration.data.datasets[1].data = newData.approvals;
                this.charts.registration.update();
            }
        }
    }

    // Global functions
    window.updateChart = function(period) {
        if (window.dashboard) {
            window.dashboard.updateChart(period);
        }
    };

    // Initialize dashboard when DOM is ready
    document.addEventListener('DOMContentLoaded', function() {
        window.dashboard = new AdminDashboard();
        console.log('Admin Dashboard initialized');
    });
    </script>

    <style>
    /* Dashboard Specific Styles */
    .welcome-section {
        margin-bottom: 2rem;
    }

    .welcome-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 16px;
        padding: 2rem;
        color: white;
        position: relative;
        overflow: hidden;
    }

    .welcome-card::before {
        content: '';
        position: absolute;
        top: -50%;
        right: -50%;
        width: 100%;
        height: 100%;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 50%;
        transform: rotate(45deg);
    }

    .welcome-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
        position: relative;
        z-index: 2;
    }

    .welcome-title {
        font-size: 1.75rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
    }

    .welcome-subtitle {
        font-size: 1rem;
        opacity: 0.9;
        margin-bottom: 0;
    }

    .welcome-stats {
        display: flex;
        gap: 2rem;
    }

    .quick-stat {
        text-align: center;
    }

    .stat-number {
        display: block;
        font-size: 2rem;
        font-weight: 700;
        line-height: 1;
    }

    .stat-label {
        font-size: 0.875rem;
        opacity: 0.9;
        margin-top: 0.25rem;
    } 
   /* Metrics Grid */
    .metrics-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
    }

    .metric-card {
        background: white;
        border-radius: 12px;
        padding: 1.5rem;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        border: 1px solid #e5e7eb;
        display: flex;
        align-items: center;
        gap: 1rem;
        transition: all 0.3s ease;
    }

    .metric-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
    }

    .metric-content {
        flex: 1;
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .metric-icon {
        width: 48px;
        height: 48px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        color: white;
    }

    .metric-primary .metric-icon { background: #3b82f6; }
    .metric-success .metric-icon { background: #10b981; }
    .metric-warning .metric-icon { background: #f59e0b; }
    .metric-info .metric-icon { background: #06b6d4; }

    .metric-details h3 {
        font-size: 1.875rem;
        font-weight: 700;
        margin: 0;
        color: #1f2937;
    }

    .metric-label {
        font-size: 0.875rem;
        color: #6b7280;
        margin: 0.25rem 0;
    }

    .metric-trend {
        font-size: 0.75rem;
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 0.25rem;
    }

    .metric-trend.positive { color: #10b981; }
    .metric-trend.negative { color: #ef4444; }
    .metric-trend.neutral { color: #6b7280; }

    .metric-chart {
        width: 80px;
        height: 40px;
    }

    /* Dashboard Cards */
    .dashboard-card {
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        border: 1px solid #e5e7eb;
        overflow: hidden;
    }

    .card-header {
        padding: 1.5rem;
        border-bottom: 1px solid #e5e7eb;
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
    }

    .card-title {
        font-size: 1.125rem;
        font-weight: 600;
        color: #1f2937;
        margin: 0;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .card-subtitle {
        font-size: 0.875rem;
        color: #6b7280;
        margin: 0.25rem 0 0 0;
    }

    .card-body {
        padding: 1.5rem;
    }

    /* Quick Actions */
    .quick-actions {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
    }

    .quick-action-item {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 1rem;
        border-radius: 8px;
        background: #f9fafb;
        text-decoration: none;
        color: inherit;
        transition: all 0.2s ease;
    }

    .quick-action-item:hover {
        background: #f3f4f6;
        transform: translateX(4px);
        color: inherit;
        text-decoration: none;
    }

    .action-icon {
        width: 40px;
        height: 40px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.25rem;
    }

    .action-content h6 {
        font-size: 0.875rem;
        font-weight: 600;
        margin: 0;
        color: #1f2937;
    }

    .action-content p {
        font-size: 0.75rem;
        color: #6b7280;
        margin: 0.25rem 0 0 0;
    }

    .action-arrow {
        margin-left: auto;
        color: #9ca3af;
        font-size: 1rem;
    }

    /* Recent Registrations */
    .registration-item {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 1rem 0;
        border-bottom: 1px solid #f3f4f6;
    }

    .registration-item:last-child {
        border-bottom: none;
    }

    .registration-avatar {
        width: 40px;
        height: 40px;
        border-radius: 8px;
        overflow: hidden;
        flex-shrink: 0;
    }

    .registration-avatar img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .avatar-placeholder {
        width: 100%;
        height: 100%;
        background: #3b82f6;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        font-size: 1rem;
    }

    .registration-info {
        flex: 1;
    }

    .registration-name {
        font-size: 0.875rem;
        font-weight: 600;
        margin: 0;
        color: #1f2937;
    }

    .registration-details {
        font-size: 0.75rem;
        color: #6b7280;
        margin: 0.25rem 0;
    }

    .registration-time {
        font-size: 0.75rem;
        color: #9ca3af;
    }    /* 
System Status */
    .system-status {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .status-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.75rem 0;
        border-bottom: 1px solid #f3f4f6;
    }

    .status-item:last-child {
        border-bottom: none;
    }

    .status-indicator {
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }

    .status-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        flex-shrink: 0;
    }

    .status-dot.status-online { background: #10b981; }
    .status-dot.status-warning { background: #f59e0b; }
    .status-dot.status-error { background: #ef4444; }

    .status-label {
        font-size: 0.875rem;
        color: #374151;
        font-weight: 500;
    }

    .status-value {
        font-size: 0.875rem;
        color: #6b7280;
    }

    .system-metrics {
        border-top: 1px solid #f3f4f6;
        padding-top: 1rem;
    }

    .metric-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.5rem 0;
    }

    .metric-row .metric-label {
        font-size: 0.875rem;
        color: #6b7280;
    }

    .metric-row .metric-value {
        font-size: 0.875rem;
        font-weight: 600;
        color: #1f2937;
    }

    /* Activity Types */
    .activity-types {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .activity-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.75rem 0;
    }

    .activity-info {
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }

    .activity-color {
        width: 12px;
        height: 12px;
        border-radius: 3px;
        flex-shrink: 0;
    }

    .activity-name {
        font-size: 0.875rem;
        color: #374151;
    }

    .activity-count {
        font-size: 0.875rem;
        font-weight: 600;
        color: #1f2937;
    }

    /* Admin Activity Timeline */
    .activity-timeline {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .timeline-item {
        display: flex;
        align-items: flex-start;
        gap: 1rem;
    }

    .timeline-marker {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        margin-top: 0.5rem;
        flex-shrink: 0;
    }

    .timeline-content {
        flex: 1;
    }

    .timeline-text {
        font-size: 0.875rem;
        color: #374151;
        margin: 0;
    }

    .timeline-time {
        font-size: 0.75rem;
        color: #9ca3af;
    }

    /* Empty State */
    .empty-state {
        padding: 2rem;
    }

    .empty-state-icon {
        font-size: 3rem;
        color: #d1d5db;
        margin-bottom: 1rem;
    }

    .empty-state-title {
        font-size: 1rem;
        font-weight: 600;
        color: #374151;
        margin-bottom: 0.5rem;
    }

    .empty-state-text {
        font-size: 0.875rem;
        color: #6b7280;
        margin: 0;
    }

    /* Chart Container */
    .chart-container {
        position: relative;
        height: 300px;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
        .welcome-content {
            flex-direction: column;
            align-items: flex-start;
            gap: 1.5rem;
        }

        .welcome-stats {
            align-self: stretch;
            justify-content: space-around;
        }

        .metrics-grid {
            grid-template-columns: 1fr;
        }

        .metric-card {
            padding: 1rem;
        }

        .card-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 1rem;
        }
    }

    /* Dark Mode Support */
    [data-theme="dark"] .dashboard-card,
    [data-theme="dark"] .metric-card {
        background: #1f2937;
        border-color: #374151;
    }

    [data-theme="dark"] .card-header {
        border-color: #374151;
    }

    [data-theme="dark"] .card-title,
    [data-theme="dark"] .metric-details h3 {
        color: #f9fafb;
    }

    [data-theme="dark"] .quick-action-item {
        background: #374151;
    }

    [data-theme="dark"] .quick-action-item:hover {
        background: #4b5563;
    }
    </style>
</body>
</html>