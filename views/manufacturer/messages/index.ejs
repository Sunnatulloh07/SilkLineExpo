<%- include('../partials/header', { title: t('manufacturer.messages.page_title'), lng: lng, user: user, t: t }) %>
<%- include('../partials/sidebar', { user: user, currentPage: 'messages', t: t }) %>

<!-- Professional CSS Imports - Matching Orders Page Architecture -->
<link rel="stylesheet" href="/css/products-management-redesign.css">
<link rel="stylesheet" href="/css/products-table-view.css">
<link rel="stylesheet" href="/css/orders-management.css">
<link rel="stylesheet" href="/css/manufacturer-cards.css">
<link rel="stylesheet" href="/css/manufacturer-theme.css">
<link rel="stylesheet" href="/css/toast-notifications.css">
<link rel="stylesheet" href="/css/modal-system.css">
<link rel="stylesheet" href="/css/manufacturer/messages.css">

<!-- Main Content -->
<main class="admin-main">
  <div class="admin-content">
    
    <!-- Professional B2B Messages Header -->
    <div class="orders-header animate-fade-in">
      <div class="orders-header-content">
        <div class="orders-title-section">
          <h1 class="orders-main-title">
            <i class="fas fa-comments"></i>
            <%= t('manufacturer.messages.header.title') %>
          </h1>
          <p class="orders-subtitle"><%= t('manufacturer.messages.header.subtitle') %></p>
        </div>
      </div>
    </div>

    <!-- Professional Filters Container - Messages Style -->
    <div class="products-filters-container">
      <div class="products-filters-header">
        <h3 class="products-filters-title">
          <i class="fas fa-filter"></i>
          <%= t('manufacturer.messages.filters.title') %>
        </h3>
      </div>
      <div class="products-filters-body">
        <form id="messagesFiltersForm" class="products-filters-form">
          
          <!-- Search Input -->
          <div class="products-filter-group">
            <label class="products-filter-label"><%= t('manufacturer.messages.filters.search') %></label>
            <div class="products-search-wrapper">
              <i class="fas fa-search products-search-icon"></i>
              <input 
                type="text" 
                id="messagesSearchInput" 
                name="search" 
                placeholder="<%= t('manufacturer.messages.filters.search_placeholder') %>"
                class="products-form-input search"
              >
            </div>
          </div>

          <!-- Status Filter -->
          <div class="products-filter-group">
            <label class="products-filter-label"><%= t('manufacturer.messages.filters.status_filter') %></label>
            <select name="status" id="messagesStatusFilter" class="products-form-select">
              <option value=""><%= t('manufacturer.messages.filters.status_all') %></option>
              <option value="active"><%= t('manufacturer.messages.status.active') %></option>
              <option value="read"><%= t('manufacturer.messages.status.completed') %></option>
              <option value="no_messages"><%= t('manufacturer.messages.status.pending') %></option>
              <option value="archived"><%= t('manufacturer.messages.status.archived') %></option>
            </select>
          </div>

          <!-- Order Status Filter -->
          <div class="products-filter-group">
            <label class="products-filter-label"><%= t('manufacturer.messages.filters.order_status') %></label>
            <select name="orderStatus" id="messagesOrderStatusFilter" class="products-form-select">
              <option value=""><%= t('manufacturer.messages.filters.all_orders') %></option>
              <option value="pending"><%= t('manufacturer.messages.status.pending') %></option>
              <option value="confirmed"><%= t('manufacturer.messages.status.confirmed') %></option>
              <option value="processing"><%= t('manufacturer.messages.status.processing') %></option>
              <option value="manufacturing"><%= t('manufacturer.messages.status.manufacturing') %></option>
              <option value="ready_to_ship"><%= t('manufacturer.messages.status.ready_to_ship') %></option>
              <option value="shipped"><%= t('manufacturer.messages.status.shipped') %></option>
              <option value="delivered"><%= t('manufacturer.messages.status.delivered') %></option>
              <option value="completed"><%= t('manufacturer.messages.status.completed') %></option>
              <option value="cancelled"><%= t('manufacturer.messages.status.cancelled') %></option>
            </select>
          </div>

          <!-- Date Range Filter -->
          <div class="products-filter-group">
            <label class="products-filter-label"><%= t('manufacturer.messages.filters.date_range') %></label>
            <select name="dateRange" id="messagesDateRangeFilter" class="products-form-select">
              <option value=""><%= t('manufacturer.messages.filters.all_time') %></option>
              <option value="today"><%= t('manufacturer.messages.filters.today') %></option>
              <option value="week"><%= t('manufacturer.messages.filters.this_week') %></option>
              <option value="month"><%= t('manufacturer.messages.filters.this_month') %></option>
              <option value="quarter"><%= t('manufacturer.messages.filters.this_quarter') %></option>
              <option value="year"><%= t('manufacturer.messages.filters.this_year') %></option>
              <option value="custom"><%= t('manufacturer.messages.filters.custom_range') %></option>
            </select>
          </div>

          <!-- Partner Filter -->
          <div class="products-filter-group">
            <label class="products-filter-label"><%= t('manufacturer.messages.filters.partner_filter') %></label>
            <select name="partner" id="messagesPartnerFilter" class="products-form-select">
              <option value=""><%= t('manufacturer.messages.filters.partner_all') %></option>
              <!-- Dynamically populated -->
            </select>
          </div>

          <!-- Sort Options -->
          <div class="products-filter-group">
            <label class="products-filter-label"><%= t('manufacturer.messages.filters.sort_by') %></label>
            <select name="sortBy" id="messagesSortFilter" class="products-form-select">
              <option value="lastMessageAt"><%= t('manufacturer.messages.filters.last_message_time') %></option>
              <option value="partner"><%= t('manufacturer.messages.filters.partner_name') %></option>
              <option value="orderNumber"><%= t('manufacturer.messages.filters.order_id') %></option>
              <option value="unreadCount"><%= t('manufacturer.messages.filters.unread_messages') %></option>
            </select>
          </div>

          <!-- Sort Order -->
          <div class="products-filter-group">
            <label class="products-filter-label"><%= t('manufacturer.messages.filters.sort_order') %></label>
            <select name="sortOrder" id="messagesSortOrderFilter" class="products-form-select">
              <option value="desc"><%= t('manufacturer.messages.filters.descending') %></option>
              <option value="asc"><%= t('manufacturer.messages.filters.ascending') %></option>
            </select>
          </div>
          
          <div class="products-filters-submit">
            <button type="submit" class="products-btn products-btn-primary" id="searchMessagesFiltersBtn">
              <i class="fas fa-search"></i>
              <%= t('manufacturer.messages.filters.search') %>
            </button>
            <button type="button" class="products-btn products-btn-secondary" id="clearMessagesFiltersBtn">
              <i class="fas fa-times"></i>
              <%= t('manufacturer.messages.filters.clear') %>
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Main Messages Container -->
    <div class="products-main-container">
      <div class="products-content-header">
        <h3 class="products-content-title">
          <i class="fas fa-inbox"></i>
          <%= t('manufacturer.messages.table.headers.title') %>
          <span class="products-count" id="conversationsCountText">
            <%= conversations ? conversations.length : 0 %>
          </span>
        </h3>
        <div class="products-content-actions">

          <div class="products-table-actions">
            <button class="products-btn products-btn-sm products-btn-secondary" id="refreshConversationsBtn" title="<%= t('manufacturer.messages.actions.refresh') %>">
              <i class="fas fa-sync-alt"></i>
            </button>
          </div>
        </div>
      </div>
      
      <!-- TABLE VIEW - Loading State -->
      <div class="products-view-container" id="messagesTableView">
        <div class="products-table-container">
          <div class="products-table-header">
              <h4 class="products-table-title">
                <i class="fas fa-table"></i>
                <%= t('manufacturer.messages.table.title') %>
              </h4>
          </div>
          
          <div class="products-table-wrapper">
            <table class="products-table orders-table" id="conversationsTable">
              <thead>
                <tr>
                  <th class="table-checkbox-col">
                    <input type="checkbox" id="selectAllConversations" class="table-checkbox">
                  </th>
                  <th class="partner-col sortable" data-sort="partner">
                    <%= t('manufacturer.messages.table.headers.partner') %>
                    <i class="fas fa-sort sort-icon"></i>
                  </th>
                  <th class="order-id-col sortable" data-sort="order">
                    <%= t('manufacturer.messages.table.headers.order_id') %>
                    <i class="fas fa-sort sort-icon"></i>
                  </th>
                  <th class="message-col">
                    <%= t('manufacturer.messages.table.headers.last_message') %>
                  </th>
                  <th class="date-col sortable" data-sort="time">
                    <%= t('manufacturer.messages.table.headers.date') %>
                    <i class="fas fa-sort sort-icon"></i>
                  </th>
                  <th class="status-col sortable" data-sort="status">
                    <%= t('manufacturer.messages.table.headers.status') %>
                    <i class="fas fa-sort sort-icon"></i>
                  </th>
                  <th class="actions-col"><%= t('manufacturer.messages.table.headers.actions') %></th>
                </tr>
              </thead>
              <tbody id="conversationsTableBody">
                <!-- Table content will be loaded dynamically -->
              </tbody>
            </table>
          </div>
          
          <!-- Professional Pagination - Products Page Style -->
          <div class="table-pagination" id="messagesPagination" style="display: none;">
            <div class="table-pagination-info">
              <span id="paginationInfo"><%= t('manufacturer.messages.pagination.showing') %> 1 <%= t('manufacturer.messages.pagination.of') %> 0, <%= t('manufacturer.messages.pagination.total') %> 0 <%= t('manufacturer.messages.pagination.conversations') %></span>
            </div>
            <div class="table-pagination-controls" id="paginationControls">
              <!-- Pagination buttons will be inserted here -->
            </div>
          </div>
        </div>
      </div>


    </div>

  </div>
</main>

<!-- i18n Initialization -->
<script src="/js/i18n.js"></script>

<!-- Dashboard Initialization -->
<script src="/js/manufacturer/dashboard-init.js"></script>

<!-- Professional Unified Header Management -->
<script src="/js/manufacturer/manufacturer-header.js"></script>


<script type="application/json" id="translations">
  {
    "manufacturer.messages.chat.chat_info.inquiry_number": "<%= t('manufacturer.messages.chat.chat_info.inquiry_number') %>",
    "manufacturer.messages.chat.chat_info.order_number": "<%= t('manufacturer.messages.chat.chat_info.order_number') %>",
    "manufacturer.messages.chat.messages.online": "<%= t('manufacturer.messages.chat.messages.online') %>",
    "manufacturer.messages.chat.no_messages_yet": "<%= t('manufacturer.messages.chat.no_messages_yet') %>",
    "manufacturer.messages.chat.no_messages": "<%= t('manufacturer.messages.chat.no_messages') %>",
    "manufacturer.messages.chat.text_message": "<%= t('manufacturer.messages.chat.text_message') %>",
    "manufacturer.messages.status.pending": "<%= t('manufacturer.messages.status.pending') %>",
    "manufacturer.messages.status.cancelled": "<%= t('manufacturer.messages.status.cancelled') %>",
    "manufacturer.messages.status.unknown": "<%= t('manufacturer.messages.status.unknown') %>",
    "manufacturer.messages.table.actions.main_actions": "<%= t('manufacturer.messages.table.actions.main_actions') %>",
    "manufacturer.messages.table.actions.open_conversation": "<%= t('manufacturer.messages.table.actions.open_conversation') %>",
    "manufacturer.messages.table.actions.view_order": "<%= t('manufacturer.messages.table.actions.view_order') %>",
    "manufacturer.messages.table.actions.mark_as_read": "<%= t('manufacturer.messages.table.actions.mark_as_read') %>",
    "manufacturer.messages.table.actions.additional_actions": "<%= t('manufacturer.messages.table.actions.additional_actions') %>",
    "manufacturer.messages.table.actions.archive": "<%= t('manufacturer.messages.table.actions.archive') %>",
    "manufacturer.messages.table.actions.export": "<%= t('manufacturer.messages.table.actions.export') %>",
    "manufacturer.messages.table.actions.pin": "<%= t('manufacturer.messages.table.actions.pin') %>",
    "manufacturer.messages.table.actions.dangerous_actions": "<%= t('manufacturer.messages.table.actions.dangerous_actions') %>",
    "manufacturer.messages.table.actions.delete_conversation": "<%= t('manufacturer.messages.table.actions.delete_conversation') %>",
    "manufacturer.messages.table.actions.view_order": "<%= t('manufacturer.messages.table.actions.view_order') %>"
  }
</script>
<!-- Set translation function for JavaScript -->
<script>
// Pass server-side translations to client-side
window.translations = JSON.parse(document.getElementById('translations').textContent);

window.t = function(key, fallback = '') {
  try {
    // Use server-side translations
    if (window.translations && window.translations[key]) {
      return window.translations[key];
    }
    // Fallback to provided fallback or key
    return fallback || key;
  } catch (error) {
    console.error('Translation error:', error);
    return fallback || key;
  }
};
</script>

<script src="/js/manufacturer/messages.js"></script>


</body>
</html>